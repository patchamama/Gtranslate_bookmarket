javascript:(function(){'use strict';const STORAGE_KEYS={WORD:'wordrefMemoryWord',PARAMS:'wordrefMemoryParams',HISTORY:'wordrefHistory',LAST_DIALOG:'wordrefLastDialog',SORT_MODE:'wordrefSortMode'};const LANGUAGES=['en','es','de','fr'];const WORDREF_BASE_URL='https://www.wordreference.com/';const WORDREF_DOMAIN='wordreference.com';function getNextLanguage(currentLang,sourceLang){const currentIndex=LANGUAGES.indexOf(currentLang);let nextIndex=(currentIndex+1)%LANGUAGES.length;let nextLang=LANGUAGES[nextIndex];if(nextLang===sourceLang){nextIndex=(nextIndex+1)%LANGUAGES.length;nextLang=LANGUAGES[nextIndex]}return nextLang}function getSavedParams(){const saved=localStorage.getItem(STORAGE_KEYS.PARAMS);if(!saved){return{sl:'en',tl:'es',text:''}}return JSON.parse(saved)}function saveParams(sl,tl,text){const params={sl,tl,text};localStorage.setItem(STORAGE_KEYS.PARAMS,JSON.stringify(params));localStorage.setItem(STORAGE_KEYS.WORD,text)}function getHistory(){const history=localStorage.getItem(STORAGE_KEYS.HISTORY);return history?JSON.parse(history):[]}function addToHistory(word,sl,tl){if(!word||word.trim()==='')return;const history=getHistory();const entry={word:word.trim(),sl:sl,tl:tl,timestamp:new Date().toISOString()};if(history.length>0){const lastEntry=history[history.length-1];if(lastEntry.word===entry.word&&lastEntry.sl===entry.sl&&lastEntry.tl===entry.tl){return}}history.push(entry);localStorage.setItem(STORAGE_KEYS.HISTORY,JSON.stringify(history))}function buildWordReferenceURL(sl,tl,text){return WORDREF_BASE_URL+sl+tl+'/'+encodeURIComponent(text)}function isOnWordReference(){return window.location.hostname.includes(WORDREF_DOMAIN)}function navigateToURL(url){if(isOnWordReference()){window.location.href=url}else{window.open(url,'_blank')}}function shouldShowDialog(){const history=getHistory();if(history.length===0){return true}const lastDialog=localStorage.getItem(STORAGE_KEYS.LAST_DIALOG);if(!lastDialog){return true}const lastDate=new Date(lastDialog);const today=new Date();if(lastDate.getFullYear()!==today.getFullYear()||lastDate.getMonth()!==today.getMonth()||lastDate.getDate()!==today.getDate()){return true}return false}function markDialogShown(){localStorage.setItem(STORAGE_KEYS.LAST_DIALOG,new Date().toISOString())}function performTranslation(){const savedParams=getSavedParams();const lastWord=localStorage.getItem(STORAGE_KEYS.WORD)||'';const userInput=prompt('Word to translate:\\n(Empty, "history" or "?" to view history)',lastWord);if(userInput===null)return;const trimmedInput=userInput.trim().toLowerCase();if(trimmedInput===''||trimmedInput==='history'||trimmedInput==='?'){showHistory();return}const originalInput=userInput.trim();const wordChanged=originalInput!==lastWord;let sl=savedParams.sl;let tl=savedParams.tl;if(!wordChanged){tl=getNextLanguage(tl,sl)}saveParams(sl,tl,originalInput);addToHistory(originalInput,sl,tl);const url=buildWordReferenceURL(sl,tl,originalInput);navigateToURL(url)}function groupHistory(history){const grouped={};history.forEach(item=>{const key=item.word;if(!grouped[key]){grouped[key]={word:item.word,sl:item.sl,tl:item.tl,count:0,firstDate:item.timestamp,lastDate:item.timestamp}}grouped[key].count++;if(new Date(item.timestamp)>new Date(grouped[key].lastDate)){grouped[key].lastDate=item.timestamp;grouped[key].sl=item.sl;grouped[key].tl=item.tl}});return Object.values(grouped)}function generateHistoryItemsHTML(history){if(history.length===0){return'<div class="empty-state"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 2C7.89 2 7 2.9 7 4V20C7 21.1 7.89 22 9 22H18C19.1 22 20 21.1 20 20V8L14 2H9M13 3.5L18.5 9H13V3.5M10 19V17H17V19H10M10 15V13H17V15H10M10 11V9H17V11H10Z"/></svg><h3>No history yet</h3><p>Your searched words will appear here</p></div>'}const groupedHistory=groupHistory(history);let html='';for(let i=0;i<groupedHistory.length;i++){const item=groupedHistory[i];const date=new Date(item.lastDate);const formattedDate=date.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});const url=buildWordReferenceURL(item.sl,item.tl,item.word);const escapedWord=item.word.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');const countBadge=item.count>1?`<span class="count-badge">√ó${item.count}</span>`:'';html+='<div class="history-item"><a href="'+url+'" target="_blank"><div><div class="word">'+escapedWord+countBadge+'</div><div class="meta"><span class="lang-badge">'+item.sl.toUpperCase()+'</span><span class="lang-badge">'+item.tl.toUpperCase()+'</span><span>'+formattedDate+'</span></div></div><span>‚Üí</span></a><button class="btn-delete" data-word="'+escapedWord+'" data-sl="'+item.sl+'" data-tl="'+item.tl+'">√ó</button></div>'}return html}function showHistory(){const history=getHistory();const groupedHistory=groupHistory(history);const historyItemsHTML=generateHistoryItemsHTML(history);const htmlContent='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>WordReference History</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);min-height:100vh;padding:20px}.container{max-width:900px;margin:0 auto;background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}.header{background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);color:white;padding:30px;text-align:center}.header h1{font-size:28px;margin-bottom:10px}.header p{opacity:0.9;font-size:14px}.controls{padding:20px 30px;background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;flex-wrap:wrap;gap:10px}.search-box{flex:1 1 300px;display:flex;align-items:center;gap:10px}.search-box input{flex:1;padding:10px;border:1px solid #ced4da;border-radius:6px;font-size:14px}.btn{padding:10px 20px;border:none;border-radius:6px;font-size:14px;cursor:pointer;transition:all 0.3s;font-weight:500}.btn-primary{background:#ff7043;color:white}.btn-primary:hover{background:#d94d20;transform:translateY(-2px);box-shadow:0 4px 12px rgba(240,90,40,0.4)}.btn-success{background:#28a745;color:white}.btn-success:hover{background:#218838;transform:translateY(-2px)}.btn-warning{background:#ffc107;color:#212529}.btn-warning:hover{background:#e0a800;transform:translateY(-2px)}.btn-danger{background:#dc3545;color:white}.btn-danger:hover{background:#c82333;transform:translateY(-2px)}.stats{padding:15px 30px;background:#fff3e0;border-bottom:1px solid #ffe0b2;font-size:14px;color:#e65100;font-weight:500}.history-list{padding:20px 30px;max-height:600px;overflow-y:auto}.history-item{padding:15px;margin-bottom:10px;background:#f8f9fa;border-radius:8px;border-left:4px solid #f05a28;transition:all 0.3s;display:flex;align-items:center;gap:10px}.history-item:hover{background:#e9ecef;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.history-item a{text-decoration:none;color:#212529;flex:1;display:flex;justify-content:space-between;align-items:center}.word{font-size:18px;font-weight:600;color:#f05a28}.meta{font-size:12px;color:#6c757d;margin-top:5px}.lang-badge{display:inline-block;padding:2px 8px;background:#ff7043;color:white;border-radius:4px;font-size:11px;margin-right:5px}.count-badge{display:inline-block;padding:2px 8px;background:#ff6b6b;color:white;border-radius:4px;font-size:11px;margin-left:8px;font-weight:bold}.empty-state{text-align:center;padding:60px 20px;color:#6c757d}.empty-state svg{width:100px;height:100px;margin-bottom:20px;opacity:0.3}input[type="file"]{display:none}.btn-delete{background:#dc3545;color:white;border:none;border-radius:4px;padding:5px 10px;font-size:12px;cursor:pointer;transition:all 0.2s}.btn-delete:hover{background:#c82333;transform:scale(1.1)}@media (max-width:600px){.controls{flex-direction:column}.btn{width:100%}.search-box{flex:1 1 100%}}</style></head><body><div class="container"><div class="header"><h1>üìö WordReference History</h1><p>All your WordReference searches</p></div><div class="controls"><div class="search-box"><input type="text" id="searchInput" placeholder="üîç Search words..."><button class="btn btn-primary" id="btnClearSearch">‚úï</button></div><button class="btn btn-primary" id="btnSortDate">üïê By Date</button><button class="btn btn-primary" id="btnSortAlpha">üî§ A-Z</button><button class="btn btn-primary" id="btnSortCount">üî¢ By Usage</button><button class="btn btn-success" id="btnExport">üíæ Export</button><button class="btn btn-warning" id="btnImport">üì• Import</button><input type="file" id="importFile" accept=".json"><button class="btn btn-danger" id="btnClear">üóëÔ∏è Clear All</button></div><div class="stats">Unique words: <strong id="totalCount">'+groupedHistory.length+'</strong> | Showing: <strong id="showingCount">'+groupedHistory.length+'</strong></div><div class="history-list" id="historyList">'+historyItemsHTML+'</div></div></body></html>';try{const blob=new Blob([htmlContent],{type:'text/html;charset=utf-8'});const blobURL=URL.createObjectURL(blob);const newWindow=window.open(blobURL,'_blank');if(newWindow){setTimeout(function(){injectScripts(newWindow,history,groupedHistory)},200)}else{fallbackToDataURI(htmlContent,history,groupedHistory)}}catch(error){fallbackToDataURI(htmlContent,history,groupedHistory)}}function fallbackToDataURI(htmlContent,history,groupedHistory){try{const dataURI='data:text/html;charset=utf-8,'+encodeURIComponent(htmlContent);const dataWindow=window.open(dataURI,'_blank');if(dataWindow){setTimeout(function(){injectScripts(dataWindow,history,groupedHistory)},200)}else{alert('Could not open history. Please allow popups.')}}catch(e){alert('Error opening history: '+e.message)}}function injectScripts(win,history,groupedHistory){if(!win||win.closed)return;try{win.rawHistory=JSON.parse(JSON.stringify(history));win.groupedHistory=JSON.parse(JSON.stringify(groupedHistory));win.currentView='date';win.searchTerm='';win.filteredHistory=JSON.parse(JSON.stringify(groupedHistory));win.getLocalStorage=function(key){try{if(window.opener&&!window.opener.closed){return window.opener.localStorage.getItem(key)}return localStorage.getItem(key)}catch(e){return localStorage.getItem(key)}};win.setLocalStorage=function(key,value){try{if(window.opener&&!window.opener.closed){window.opener.localStorage.setItem(key,value)}localStorage.setItem(key,value)}catch(e){localStorage.setItem(key,value)}};win.removeLocalStorage=function(key){try{if(window.opener&&!window.opener.closed){window.opener.localStorage.removeItem(key)}localStorage.removeItem(key)}catch(e){localStorage.removeItem(key)}};win.escapeHtml=function(text){var div=win.document.createElement('div');div.textContent=text;return div.innerHTML};win.groupHistory=function(historyArray){var grouped={};for(var i=0;i<historyArray.length;i++){var item=historyArray[i];var key=item.word;if(!grouped[key]){grouped[key]={word:item.word,sl:item.sl,tl:item.tl,count:0,firstDate:item.timestamp,lastDate:item.timestamp}}grouped[key].count++;if(new Date(item.timestamp)>new Date(grouped[key].lastDate)){grouped[key].lastDate=item.timestamp;grouped[key].sl=item.sl;grouped[key].tl=item.tl}}return Object.keys(grouped).map(function(key){return grouped[key]})};win.generateHistoryHTML=function(data){if(data.length===0){return'<div class="empty-state"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 2C7.89 2 7 2.9 7 4V20C7 21.1 7.89 22 9 22H18C19.1 22 20 21.1 20 20V8L14 2H9M13 3.5L18.5 9H13V3.5M10 19V17H17V19H10M10 15V13H17V15H10M10 11V9H17V11H10Z"/></svg><h3>No history yet</h3><p>Your searched words will appear here</p></div>'}var html='';for(var i=0;i<data.length;i++){var item=data[i];var date=new Date(item.lastDate);var formattedDate=date.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});var url='https://www.wordreference.com/'+item.sl+item.tl+'/'+encodeURIComponent(item.word);var escapedWord=win.escapeHtml(item.word);var countBadge=item.count>1?'<span class="count-badge">√ó'+item.count+'</span>':'';html+='<div class="history-item"><a href="'+url+'" target="_blank"><div><div class="word">'+escapedWord+countBadge+'</div><div class="meta"><span class="lang-badge">'+item.sl.toUpperCase()+'</span><span class="lang-badge">'+item.tl.toUpperCase()+'</span><span>'+formattedDate+'</span></div></div><span>‚Üí</span></a><button class="btn-delete" data-word="'+escapedWord+'" data-sl="'+item.sl+'" data-tl="'+item.tl+'">√ó</button></div>'}return html};win.applySearch=function(){if(!win.searchTerm){win.filteredHistory=win.groupedHistory}else{var term=win.searchTerm.toLowerCase();win.filteredHistory=win.groupedHistory.filter(function(item){return item.word.toLowerCase().indexOf(term)!==-1})}win.updateDisplay()};win.updateDisplay=function(){var list=win.document.getElementById('historyList');var counter=win.document.getElementById('totalCount');var showingCounter=win.document.getElementById('showingCount');if(list){var html=win.generateHistoryHTML(win.filteredHistory);try{if(win.trustedTypes&&win.trustedTypes.createPolicy){if(!win.gtPolicy){try{win.gtPolicy=win.trustedTypes.createPolicy('wordreference',{createHTML:function(s){return s}})}catch(e){win.gtPolicy=win.trustedTypes.defaultPolicy}}if(win.gtPolicy){list.innerHTML=win.gtPolicy.createHTML(html)}else{list.innerHTML=html}}else{list.innerHTML=html}}catch(e){list.textContent='';var temp=win.document.createElement('div');temp.innerHTML=html;while(temp.firstChild){list.appendChild(temp.firstChild)}}}if(counter){counter.textContent=win.groupedHistory.length}if(showingCounter){showingCounter.textContent=win.filteredHistory.length}win.attachDeleteListeners()};win.attachDeleteListeners=function(){var btns=win.document.querySelectorAll('.btn-delete');for(var i=0;i<btns.length;i++){btns[i].addEventListener('click',function(e){e.preventDefault();e.stopPropagation();win.deleteWord(this.getAttribute('data-word'),this.getAttribute('data-sl'),this.getAttribute('data-tl'))})}};win.deleteWord=function(word,sl,tl){if(!win.confirm('Delete all occurrences of "'+word+'"?')){return}win.rawHistory=win.rawHistory.filter(function(item){return item.word!==word});win.setLocalStorage('wordrefHistory',JSON.stringify(win.rawHistory));win.groupedHistory=win.groupHistory(win.rawHistory);win.applySearch();win.setLocalStorage('wordrefSortMode',win.currentView)};win.sortByDate=function(){win.groupedHistory.sort(function(a,b){return new Date(b.lastDate)-new Date(a.lastDate)});win.currentView='date';win.setLocalStorage('wordrefSortMode','date');win.applySearch()};win.sortAlphabetically=function(){win.groupedHistory.sort(function(a,b){return a.word.localeCompare(b.word)});win.currentView='alpha';win.setLocalStorage('wordrefSortMode','alpha');win.applySearch()};win.sortByCount=function(){win.groupedHistory.sort(function(a,b){if(b.count!==a.count){return b.count-a.count}return new Date(b.lastDate)-new Date(a.lastDate)});win.currentView='count';win.setLocalStorage('wordrefSortMode','count');win.applySearch()};win.applySavedSort=function(){var savedMode=win.getLocalStorage('wordrefSortMode')||'date';win.currentView=savedMode;if(savedMode==='alpha'){win.sortAlphabetically()}else if(savedMode==='count'){win.sortByCount()}else{win.sortByDate()}};win.clearHistory=function(){if(win.confirm('Are you sure you want to delete all history?')){win.removeLocalStorage('wordrefHistory');win.removeLocalStorage('wordrefSortMode');win.rawHistory=[];win.groupedHistory=[];win.filteredHistory=[];win.updateDisplay();win.alert('‚úÖ History cleared successfully')}};win.exportHistory=function(){var dataStr=JSON.stringify(win.rawHistory,null,2);var blob=new win.Blob([dataStr],{type:'application/json'});var url=win.URL.createObjectURL(blob);var a=win.document.createElement('a');a.href=url;a.download='wordreference-history-'+new Date().toISOString().split('T')[0]+'.json';win.document.body.appendChild(a);a.click();win.document.body.removeChild(a);win.URL.revokeObjectURL(url)};win.importHistory=function(event){var file=event.target.files[0];if(!file)return;var reader=new win.FileReader();reader.onload=function(e){try{var importedData=JSON.parse(e.target.result);if(!Array.isArray(importedData)){win.alert('Invalid file format');return}var combined=win.rawHistory.concat(importedData);var unique=combined.filter(function(item,index,self){return index===self.findIndex(function(t){return t.word===item.word&&t.sl===item.sl&&t.tl===item.tl&&t.timestamp===item.timestamp})});unique.sort(function(a,b){return new Date(a.timestamp)-new Date(b.timestamp)});win.setLocalStorage('wordrefHistory',JSON.stringify(unique));win.rawHistory=unique;win.groupedHistory=win.groupHistory(unique);win.applySavedSort();win.alert('‚úÖ Import successful: '+importedData.length+' entries')}catch(error){win.alert('Import error: '+error.message)}};reader.readAsText(file);event.target.value=''};var btnSortDate=win.document.getElementById('btnSortDate');var btnSortAlpha=win.document.getElementById('btnSortAlpha');var btnSortCount=win.document.getElementById('btnSortCount');var btnExport=win.document.getElementById('btnExport');var btnImport=win.document.getElementById('btnImport');var importFile=win.document.getElementById('importFile');var btnClear=win.document.getElementById('btnClear');var searchInput=win.document.getElementById('searchInput');var btnClearSearch=win.document.getElementById('btnClearSearch');if(btnSortDate){btnSortDate.addEventListener('click',function(){win.sortByDate()})}if(btnSortAlpha){btnSortAlpha.addEventListener('click',function(){win.sortAlphabetically()})}if(btnSortCount){btnSortCount.addEventListener('click',function(){win.sortByCount()})}if(btnExport){btnExport.addEventListener('click',function(){win.exportHistory()})}if(btnImport){btnImport.addEventListener('click',function(){if(importFile){importFile.click()}})}if(importFile){importFile.addEventListener('change',win.importHistory)}if(btnClear){btnClear.addEventListener('click',function(){win.clearHistory()})}if(searchInput){searchInput.addEventListener('input',function(){win.searchTerm=this.value;win.applySearch()})}if(btnClearSearch){btnClearSearch.addEventListener('click',function(){win.searchTerm='';if(searchInput){searchInput.value=''}win.applySearch()})}win.applySavedSort()}catch(e){if(win.console){win.console.error('Error injecting scripts:',e)}}}function showInitialDialog(){if(shouldShowDialog()){markDialogShown();const choice=confirm('üåê WordReference Advanced\\n\\n‚úÖ OK = Continue normal flow\\n‚ùå Cancel = View history');if(choice){performTranslation()}else{showHistory()}}else{performTranslation()}}showInitialDialog()})();
