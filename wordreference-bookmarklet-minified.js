javascript:(function(){'use strict';const STORAGE_KEYS={WORD:'wordrefMemoryWord',PARAMS:'wordrefMemoryParams',HISTORY:'wordrefHistory',LAST_DIALOG:'wordrefLastDialog',SORT_MODE:'wordrefSortMode',QUIZ_STATS:'wordrefQuizStats'};const LANGUAGES=['en','es','de','fr'];const WORDREF_BASE_URL='https://www.wordreference.com/';const WORDREF_DOMAIN='wordreference.com';function getNextLanguage(currentLang,sourceLang){const currentIndex=LANGUAGES.indexOf(currentLang);let nextIndex=(currentIndex+1)%LANGUAGES.length;let nextLang=LANGUAGES[nextIndex];if(nextLang===sourceLang){nextIndex=(nextIndex+1)%LANGUAGES.length;nextLang=LANGUAGES[nextIndex]}return nextLang}function getSavedParams(){const saved=localStorage.getItem(STORAGE_KEYS.PARAMS);if(!saved){return{sl:'en',tl:'es',text:''}}return JSON.parse(saved)}function saveParams(sl,tl,text){const params={sl,tl,text};localStorage.setItem(STORAGE_KEYS.PARAMS,JSON.stringify(params));localStorage.setItem(STORAGE_KEYS.WORD,text)}function getHistory(){const history=localStorage.getItem(STORAGE_KEYS.HISTORY);return history?JSON.parse(history):[]}function addToHistory(word,sl,tl){if(!word||word.trim()==='')return;const history=getHistory();const entry={word:word.trim(),sl:sl,tl:tl,timestamp:new Date().toISOString()};if(history.length>0){const lastEntry=history[history.length-1];if(lastEntry.word===entry.word&&lastEntry.sl===entry.sl&&lastEntry.tl===entry.tl){return}}history.push(entry);localStorage.setItem(STORAGE_KEYS.HISTORY,JSON.stringify(history))}function buildWordReferenceURL(sl,tl,text){return WORDREF_BASE_URL+sl+tl+'/'+encodeURIComponent(text)}function isOnWordReference(){return window.location.hostname.includes(WORDREF_DOMAIN)}function navigateToURL(url){if(isOnWordReference()){window.location.href=url}else{window.open(url,'_blank')}}function shouldShowDialog(){const history=getHistory();if(history.length===0){return true}const lastDialog=localStorage.getItem(STORAGE_KEYS.LAST_DIALOG);if(!lastDialog){return true}const lastDate=new Date(lastDialog);const today=new Date();if(lastDate.getFullYear()!==today.getFullYear()||lastDate.getMonth()!==today.getMonth()||lastDate.getDate()!==today.getDate()){return true}return false}function markDialogShown(){localStorage.setItem(STORAGE_KEYS.LAST_DIALOG,new Date().toISOString())}function performTranslation(){const savedParams=getSavedParams();const lastWord=localStorage.getItem(STORAGE_KEYS.WORD)||'';const userInput=prompt('Word to translate:\\n(Empty, "history", "?" or "quiz")',lastWord);if(userInput===null)return;const trimmedInput=userInput.trim().toLowerCase();if(trimmedInput==='quiz'||trimmedInput==='practice'){startQuiz();return}if(trimmedInput===''||trimmedInput==='history'||trimmedInput==='?'){showHistory();return}const originalInput=userInput.trim();const wordChanged=originalInput!==lastWord;let sl=savedParams.sl;let tl=savedParams.tl;if(!wordChanged){tl=getNextLanguage(tl,sl)}saveParams(sl,tl,originalInput);addToHistory(originalInput,sl,tl);const url=buildWordReferenceURL(sl,tl,originalInput);navigateToURL(url)}function startQuiz(){const history=getHistory();if(history.length<4){alert('You need at least 4 words in your history to practice!\\n\\nSearch more words first, then try the quiz.');return}const groupedHistory=groupHistory(history);if(groupedHistory.length<4){alert('You need at least 4 unique words to practice!\\n\\nCurrent unique words: '+groupedHistory.length);return}showQuizWindow(groupedHistory)}function showQuizWindow(words){const htmlContent=generateQuizHTML();try{const blob=new Blob([htmlContent],{type:'text/html;charset=utf-8'});const blobURL=URL.createObjectURL(blob);const quizWin=window.open(blobURL,'_blank','width=800,height=700');if(quizWin){setTimeout(function(){injectQuizScripts(quizWin,words)},300)}else{alert('Please allow popups to use the quiz feature!')}}catch(error){alert('Could not open quiz: '+error.message)}}function generateQuizHTML(){return'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>üéØ Translation Quiz</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);min-height:100vh;padding:20px;display:flex;align-items:center;justify-content:center}.quiz-container{max-width:600px;width:100%;background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}.header{background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);color:white;padding:30px;text-align:center}.header h1{font-size:28px;margin-bottom:10px}.header p{opacity:0.9;font-size:14px}.stats-bar{padding:15px 30px;background:#f8f9fa;border-bottom:2px solid #e9ecef;display:flex;justify-content:space-between;font-size:14px;font-weight:600}.stats-bar .correct{color:#28a745}.stats-bar .wrong{color:#dc3545}.question-area{padding:40px 30px;text-align:center}.question-word{font-size:32px;font-weight:700;color:#ff7043;margin-bottom:10px}.question-lang{font-size:16px;color:#6c757d;margin-bottom:30px}.options{display:flex;flex-direction:column;gap:12px}.option-btn{padding:15px 20px;border:2px solid #e9ecef;background:white;border-radius:8px;font-size:16px;cursor:pointer;transition:all 0.3s;text-align:left}.option-btn:hover{border-color:#ff7043;background:#f8f9fa;transform:translateX(5px)}.option-btn.correct{background:#d4edda;border-color:#28a745;animation:pulse 0.5s}.option-btn.wrong{background:#f8d7da;border-color:#dc3545;animation:shake 0.5s}.result-message{margin-top:20px;padding:15px;border-radius:8px;font-weight:600;text-align:center}.result-message.correct{background:#d4edda;color:#155724}.result-message.wrong{background:#f8d7da;color:#721c24}.controls{padding:20px 30px;background:#f8f9fa;display:flex;gap:10px;justify-content:center}.btn{padding:12px 30px;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s}.btn-primary{background:#ff7043;color:white}.btn-primary:hover{background:#ff5722;transform:translateY(-2px)}.btn-secondary{background:#6c757d;color:white}.btn-secondary:hover{background:#5a6268}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}.final-score{text-align:center;padding:40px}.final-score h2{font-size:48px;color:#ff7043;margin-bottom:20px}.final-score p{font-size:18px;color:#6c757d;margin-bottom:30px}</style></head><body><div class="quiz-container"><div class="header"><h1>üéØ Translation Quiz</h1><p>Test your knowledge!</p></div><div class="stats-bar"><div>Question: <span id="questionNum">1</span>/<span id="totalQuestions">10</span></div><div>Correct: <span class="correct" id="correctCount">0</span> | Wrong: <span class="wrong" id="wrongCount">0</span></div></div><div class="question-area" id="questionArea"><div class="question-word" id="questionWord"></div><div class="question-lang" id="questionLang"></div><div class="options" id="options"></div><div class="result-message" id="resultMessage"></div></div><div class="controls" id="controls" style="display:none"><button class="btn btn-primary" id="btnNext">Next Question ‚Üí</button></div></div></body></html>'}function injectQuizScripts(win,words){if(!win||win.closed)return;try{win.words=words;win.currentQuestion=0;win.correctAnswers=0;win.wrongAnswers=0;win.maxQuestions=Math.min(10,words.length);win.quizWords=[];win.shuffle=function(array){var arr=array.slice();for(var i=arr.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=arr[i];arr[i]=arr[j];arr[j]=temp}return arr};win.getRandomOptions=function(correctWord,allWords){var opts=[];opts.push({word:correctWord.word||'???',isCorrect:true});var others=[];for(var i=0;i<allWords.length;i++){if(allWords[i].word&&allWords[i].word!==correctWord.word){others.push({word:allWords[i].word,isCorrect:false})}}if(others.length>0){others=win.shuffle(others);for(var i=0;i<3&&i<others.length;i++){opts.push(others[i])}}while(opts.length<4){opts.push({word:'Option '+opts.length,isCorrect:false})}return win.shuffle(opts)};win.generateOptionsWithTranslations=function(questionData,allWords){return Promise.resolve(win.getRandomOptions(questionData,allWords))};win.escapeHtml=function(text){var div=win.document.createElement('div');div.textContent=text;return div.innerHTML};win.showQuestion=function(){if(win.currentQuestion>=win.maxQuestions){win.showFinalScore();return}var questionData=win.quizWords[win.currentQuestion];var options=win.getRandomOptions(questionData,win.words);win.document.getElementById('questionNum').textContent=win.currentQuestion+1;win.document.getElementById('totalQuestions').textContent=win.maxQuestions;win.document.getElementById('questionWord').textContent=questionData.word;win.document.getElementById('questionLang').textContent=questionData.sl.toUpperCase()+' ‚Üí '+questionData.tl.toUpperCase();var optionsHTML='';for(var i=0;i<options.length;i++){var opt=options[i];optionsHTML+='<button class="option-btn" data-correct="'+(opt.isCorrect?'true':'false')+'" data-word="'+win.escapeHtml(opt.word)+'">'+win.escapeHtml(opt.word)+'</button>'}var optionsEl=win.document.getElementById('options');try{if(win.trustedTypes&&win.trustedTypes.createPolicy){if(!win.quizPolicy){try{win.quizPolicy=win.trustedTypes.createPolicy('wordref-quiz',{createHTML:function(s){return s}})}catch(e){win.quizPolicy=win.trustedTypes.defaultPolicy}}if(win.quizPolicy){optionsEl.innerHTML=win.quizPolicy.createHTML(optionsHTML)}else{optionsEl.innerHTML=optionsHTML}}else{optionsEl.innerHTML=optionsHTML}}catch(e){optionsEl.textContent='';var temp=win.document.createElement('div');temp.innerHTML=optionsHTML;while(temp.firstChild){optionsEl.appendChild(temp.firstChild)}}win.document.getElementById('resultMessage').innerHTML='';win.document.getElementById('resultMessage').className='result-message';win.document.getElementById('controls').style.display='none';var btns=win.document.querySelectorAll('.option-btn');for(var i=0;i<btns.length;i++){btns[i].addEventListener('click',function(){win.checkAnswer(this)})}var btnNext=win.document.getElementById('btnNext');if(btnNext){btnNext.addEventListener('click',function(){win.currentQuestion++;win.showQuestion()})}};win.checkAnswer=function(btn){var isCorrect=btn.getAttribute('data-correct')==='true';var allBtns=win.document.querySelectorAll('.option-btn');for(var i=0;i<allBtns.length;i++){allBtns[i].disabled=true;if(allBtns[i].getAttribute('data-correct')==='true'){allBtns[i].classList.add('correct')}}if(isCorrect){btn.classList.add('correct');win.correctAnswers++;win.document.getElementById('resultMessage').innerHTML='‚úÖ Correct!';win.document.getElementById('resultMessage').className='result-message correct'}else{btn.classList.add('wrong');win.wrongAnswers++;win.document.getElementById('resultMessage').innerHTML='‚ùå Wrong! The correct answer is highlighted.';win.document.getElementById('resultMessage').className='result-message wrong'}win.document.getElementById('correctCount').textContent=win.correctAnswers;win.document.getElementById('wrongCount').textContent=win.wrongAnswers;win.document.getElementById('controls').style.display='flex'};win.showFinalScore=function(){var percentage=Math.round((win.correctAnswers/win.maxQuestions)*100);var message='';if(percentage>=90){message='üèÜ Perfect! Outstanding!'}else if(percentage>=80){message='üéâ Excellent! Great work!'}else if(percentage>=70){message='üëç Good! Well done!'}else if(percentage>=60){message='üëå Not bad! Keep practicing!'}else{message='üìö Keep studying! You\'ll improve!'}var html='<div class="final-score"><h2>'+percentage+'%</h2><p>'+message+'</p><p>Correct: '+win.correctAnswers+'/'+win.maxQuestions+'</p></div>';var questionArea=win.document.getElementById('questionArea');var controls=win.document.getElementById('controls');var controlsHTML='<button class="btn btn-primary" onclick="location.reload()">Try Again</button><button class="btn btn-secondary" onclick="window.close()">Close</button>';try{if(win.trustedTypes&&win.trustedTypes.createPolicy){if(!win.quizPolicy){try{win.quizPolicy=win.trustedTypes.createPolicy('wordref-quiz',{createHTML:function(s){return s}})}catch(e){win.quizPolicy=win.trustedTypes.defaultPolicy}}if(win.quizPolicy){questionArea.innerHTML=win.quizPolicy.createHTML(html);controls.innerHTML=win.quizPolicy.createHTML(controlsHTML)}else{questionArea.innerHTML=html;controls.innerHTML=controlsHTML}}else{questionArea.innerHTML=html;controls.innerHTML=controlsHTML}}catch(e){questionArea.textContent='';var temp1=win.document.createElement('div');temp1.innerHTML=html;while(temp1.firstChild){questionArea.appendChild(temp1.firstChild)}controls.textContent='';var temp2=win.document.createElement('div');temp2.innerHTML=controlsHTML;while(temp2.firstChild){controls.appendChild(temp2.firstChild)}}controls.style.display='flex';try{var stats=JSON.parse(localStorage.getItem('wordrefQuizStats'))||{total:0,correct:0};stats.total+=win.maxQuestions;stats.correct+=win.correctAnswers;localStorage.setItem('wordrefQuizStats',JSON.stringify(stats))}catch(e){}};win.quizWords=win.shuffle(win.words).slice(0,win.maxQuestions);win.showQuestion()}catch(e){if(win.console){win.console.error('Error in quiz:',e)}}}function groupHistory(history){const grouped={};history.forEach(item=>{const key=item.word;if(!grouped[key]){grouped[key]={word:item.word,sl:item.sl,tl:item.tl,count:0,firstDate:item.timestamp,lastDate:item.timestamp}}grouped[key].count++;if(new Date(item.timestamp)>new Date(grouped[key].lastDate)){grouped[key].lastDate=item.timestamp;grouped[key].sl=item.sl;grouped[key].tl=item.tl}});return Object.values(grouped)}function generateHistoryItemsHTML(history){if(history.length===0){return'<div class="empty-state"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 2C7.89 2 7 2.9 7 4V20C7 21.1 7.89 22 9 22H18C19.1 22 20 21.1 20 20V8L14 2H9M13 3.5L18.5 9H13V3.5M10 19V17H17V19H10M10 15V13H17V15H10M10 11V9H17V11H10Z"/></svg><h3>No history yet</h3><p>Your searched words will appear here</p></div>'}const groupedHistory=groupHistory(history);let html='';for(let i=0;i<groupedHistory.length;i++){const item=groupedHistory[i];const date=new Date(item.lastDate);const formattedDate=date.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});const url=buildWordReferenceURL(item.sl,item.tl,item.word);const escapedWord=item.word.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');const countBadge=item.count>1?`<span class="count-badge">√ó${item.count}</span>`:'';html+='<div class="history-item"><a href="'+url+'" target="_blank"><div><div class="word">'+escapedWord+countBadge+'</div><div class="meta"><span class="lang-badge">'+item.sl.toUpperCase()+'</span><span class="lang-badge">'+item.tl.toUpperCase()+'</span><span>'+formattedDate+'</span></div></div><span>‚Üí</span></a><button class="btn-delete" data-word="'+escapedWord+'" data-sl="'+item.sl+'" data-tl="'+item.tl+'">√ó</button></div>'}return html}function showHistory(){const history=getHistory();const groupedHistory=groupHistory(history);const historyItemsHTML=generateHistoryItemsHTML(history);const htmlContent='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>WordReference History</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);min-height:100vh;padding:20px}.container{max-width:900px;margin:0 auto;background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}.header{background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);color:white;padding:30px;text-align:center}.header h1{font-size:28px;margin-bottom:10px}.header p{opacity:0.9;font-size:14px}.controls{padding:20px 30px;background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;flex-wrap:wrap;gap:10px}.search-box{flex:1 1 300px;display:flex;align-items:center;gap:10px}.search-box input{flex:1;padding:10px;border:1px solid #ced4da;border-radius:6px;font-size:14px}.btn{padding:10px 20px;border:none;border-radius:6px;font-size:14px;cursor:pointer;transition:all 0.3s;font-weight:500}.btn-primary{background:#ff7043;color:white}.btn-primary:hover{background:#d94d20;transform:translateY(-2px);box-shadow:0 4px 12px rgba(240,90,40,0.4)}.btn-success{background:#28a745;color:white}.btn-success:hover{background:#218838;transform:translateY(-2px)}.btn-warning{background:#ffc107;color:#212529}.btn-warning:hover{background:#e0a800;transform:translateY(-2px)}.btn-danger{background:#dc3545;color:white}.btn-danger:hover{background:#c82333;transform:translateY(-2px)}.stats{padding:15px 30px;background:#fff3e0;border-bottom:1px solid #ffe0b2;font-size:14px;color:#e65100;font-weight:500}.history-list{padding:20px 30px;max-height:600px;overflow-y:auto}.history-item{padding:15px;margin-bottom:10px;background:#f8f9fa;border-radius:8px;border-left:4px solid #f05a28;transition:all 0.3s;display:flex;align-items:center;gap:10px}.history-item:hover{background:#e9ecef;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.history-item a{text-decoration:none;color:#212529;flex:1;display:flex;justify-content:space-between;align-items:center}.word{font-size:18px;font-weight:600;color:#f05a28}.meta{font-size:12px;color:#6c757d;margin-top:5px}.lang-badge{display:inline-block;padding:2px 8px;background:#ff7043;color:white;border-radius:4px;font-size:11px;margin-right:5px}.count-badge{display:inline-block;padding:2px 8px;background:#ff6b6b;color:white;border-radius:4px;font-size:11px;margin-left:8px;font-weight:bold}.empty-state{text-align:center;padding:60px 20px;color:#6c757d}.empty-state svg{width:100px;height:100px;margin-bottom:20px;opacity:0.3}input[type="file"]{display:none}.btn-delete{background:#dc3545;color:white;border:none;border-radius:4px;padding:5px 10px;font-size:12px;cursor:pointer;transition:all 0.2s}.btn-delete:hover{background:#c82333;transform:scale(1.1)}@media (max-width:600px){.controls{flex-direction:column}.btn{width:100%}.search-box{flex:1 1 100%}}</style></head><body><div class="container"><div class="header"><h1>üìö WordReference History</h1><p>All your WordReference searches</p></div><div class="controls"><div class="search-box"><input type="text" id="searchInput" placeholder="üîç Search words..."><button class="btn btn-primary" id="btnClearSearch">‚úï</button></div><button class="btn btn-primary" id="btnQuiz" style="background:#667eea">üéØ Practice Quiz</button><button class="btn btn-primary" id="btnSortDate">üïê By Date</button><button class="btn btn-primary" id="btnSortAlpha">üî§ A-Z</button><button class="btn btn-primary" id="btnSortCount">üî¢ By Usage</button><button class="btn btn-success" id="btnExport">üíæ Export</button><button class="btn btn-warning" id="btnImport">üì• Import</button><input type="file" id="importFile" accept=".json"><button class="btn btn-danger" id="btnClear">üóëÔ∏è Clear All</button></div><div class="stats">Unique words: <strong id="totalCount">'+groupedHistory.length+'</strong> | Showing: <strong id="showingCount">'+groupedHistory.length+'</strong></div><div class="history-list" id="historyList">'+historyItemsHTML+'</div></div></body></html>';try{const blob=new Blob([htmlContent],{type:'text/html;charset=utf-8'});const blobURL=URL.createObjectURL(blob);const newWindow=window.open(blobURL,'_blank');if(newWindow){setTimeout(function(){injectScripts(newWindow,history,groupedHistory)},200)}else{fallbackToDataURI(htmlContent,history,groupedHistory)}}catch(error){fallbackToDataURI(htmlContent,history,groupedHistory)}}function fallbackToDataURI(htmlContent,history,groupedHistory){try{const dataURI='data:text/html;charset=utf-8,'+encodeURIComponent(htmlContent);const dataWindow=window.open(dataURI,'_blank');if(dataWindow){setTimeout(function(){injectScripts(dataWindow,history,groupedHistory)},200)}else{alert('Could not open history. Please allow popups.')}}catch(e){alert('Error opening history: '+e.message)}}function injectScripts(win,history,groupedHistory){if(!win||win.closed)return;try{win.rawHistory=JSON.parse(JSON.stringify(history));win.groupedHistory=JSON.parse(JSON.stringify(groupedHistory));win.currentView='date';win.searchTerm='';win.filteredHistory=JSON.parse(JSON.stringify(groupedHistory));win.getLocalStorage=function(key){try{if(window.opener&&!window.opener.closed){return window.opener.localStorage.getItem(key)}return localStorage.getItem(key)}catch(e){return localStorage.getItem(key)}};win.setLocalStorage=function(key,value){try{if(window.opener&&!window.opener.closed){window.opener.localStorage.setItem(key,value)}localStorage.setItem(key,value)}catch(e){localStorage.setItem(key,value)}};win.removeLocalStorage=function(key){try{if(window.opener&&!window.opener.closed){window.opener.localStorage.removeItem(key)}localStorage.removeItem(key)}catch(e){localStorage.removeItem(key)}};win.escapeHtml=function(text){var div=win.document.createElement('div');div.textContent=text;return div.innerHTML};win.groupHistory=function(historyArray){var grouped={};for(var i=0;i<historyArray.length;i++){var item=historyArray[i];var key=item.word;if(!grouped[key]){grouped[key]={word:item.word,sl:item.sl,tl:item.tl,count:0,firstDate:item.timestamp,lastDate:item.timestamp}}grouped[key].count++;if(new Date(item.timestamp)>new Date(grouped[key].lastDate)){grouped[key].lastDate=item.timestamp;grouped[key].sl=item.sl;grouped[key].tl=item.tl}}return Object.keys(grouped).map(function(key){return grouped[key]})};win.generateHistoryHTML=function(data){if(data.length===0){return'<div class="empty-state"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 2C7.89 2 7 2.9 7 4V20C7 21.1 7.89 22 9 22H18C19.1 22 20 21.1 20 20V8L14 2H9M13 3.5L18.5 9H13V3.5M10 19V17H17V19H10M10 15V13H17V15H10M10 11V9H17V11H10Z"/></svg><h3>No history yet</h3><p>Your searched words will appear here</p></div>'}var html='';for(var i=0;i<data.length;i++){var item=data[i];var date=new Date(item.lastDate);var formattedDate=date.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});var url='https://www.wordreference.com/'+item.sl+item.tl+'/'+encodeURIComponent(item.word);var escapedWord=win.escapeHtml(item.word);var countBadge=item.count>1?'<span class="count-badge">√ó'+item.count+'</span>':'';html+='<div class="history-item"><a href="'+url+'" target="_blank"><div><div class="word">'+escapedWord+countBadge+'</div><div class="meta"><span class="lang-badge">'+item.sl.toUpperCase()+'</span><span class="lang-badge">'+item.tl.toUpperCase()+'</span><span>'+formattedDate+'</span></div></div><span>‚Üí</span></a><button class="btn-delete" data-word="'+escapedWord+'" data-sl="'+item.sl+'" data-tl="'+item.tl+'">√ó</button></div>'}return html};win.applySearch=function(){if(!win.searchTerm){win.filteredHistory=win.groupedHistory}else{var term=win.searchTerm.toLowerCase();win.filteredHistory=win.groupedHistory.filter(function(item){return item.word.toLowerCase().indexOf(term)!==-1})}win.updateDisplay()};win.updateDisplay=function(){var list=win.document.getElementById('historyList');var counter=win.document.getElementById('totalCount');var showingCounter=win.document.getElementById('showingCount');if(list){var html=win.generateHistoryHTML(win.filteredHistory);try{if(win.trustedTypes&&win.trustedTypes.createPolicy){if(!win.gtPolicy){try{win.gtPolicy=win.trustedTypes.createPolicy('wordreference',{createHTML:function(s){return s}})}catch(e){win.gtPolicy=win.trustedTypes.defaultPolicy}}if(win.gtPolicy){list.innerHTML=win.gtPolicy.createHTML(html)}else{list.innerHTML=html}}else{list.innerHTML=html}}catch(e){list.textContent='';var temp=win.document.createElement('div');temp.innerHTML=html;while(temp.firstChild){list.appendChild(temp.firstChild)}}}if(counter){counter.textContent=win.groupedHistory.length}if(showingCounter){showingCounter.textContent=win.filteredHistory.length}win.attachDeleteListeners()};win.attachDeleteListeners=function(){var btns=win.document.querySelectorAll('.btn-delete');for(var i=0;i<btns.length;i++){btns[i].addEventListener('click',function(e){e.preventDefault();e.stopPropagation();win.deleteWord(this.getAttribute('data-word'),this.getAttribute('data-sl'),this.getAttribute('data-tl'))})}};win.deleteWord=function(word,sl,tl){if(!win.confirm('Delete all occurrences of "'+word+'"?')){return}win.rawHistory=win.rawHistory.filter(function(item){return item.word!==word});win.setLocalStorage('wordrefHistory',JSON.stringify(win.rawHistory));win.groupedHistory=win.groupHistory(win.rawHistory);win.applySearch();win.setLocalStorage('wordrefSortMode',win.currentView)};win.sortByDate=function(){win.groupedHistory.sort(function(a,b){return new Date(b.lastDate)-new Date(a.lastDate)});win.currentView='date';win.setLocalStorage('wordrefSortMode','date');win.applySearch()};win.sortAlphabetically=function(){win.groupedHistory.sort(function(a,b){return a.word.localeCompare(b.word)});win.currentView='alpha';win.setLocalStorage('wordrefSortMode','alpha');win.applySearch()};win.sortByCount=function(){win.groupedHistory.sort(function(a,b){if(b.count!==a.count){return b.count-a.count}return new Date(b.lastDate)-new Date(a.lastDate)});win.currentView='count';win.setLocalStorage('wordrefSortMode','count');win.applySearch()};win.applySavedSort=function(){var savedMode=win.getLocalStorage('wordrefSortMode')||'date';win.currentView=savedMode;if(savedMode==='alpha'){win.sortAlphabetically()}else if(savedMode==='count'){win.sortByCount()}else{win.sortByDate()}};win.clearHistory=function(){if(win.confirm('Are you sure you want to delete all history?')){win.removeLocalStorage('wordrefHistory');win.removeLocalStorage('wordrefSortMode');win.rawHistory=[];win.groupedHistory=[];win.filteredHistory=[];win.updateDisplay();win.alert('‚úÖ History cleared successfully')}};win.exportHistory=function(){var dataStr=JSON.stringify(win.rawHistory,null,2);var blob=new win.Blob([dataStr],{type:'application/json'});var url=win.URL.createObjectURL(blob);var a=win.document.createElement('a');a.href=url;a.download='wordreference-history-'+new Date().toISOString().split('T')[0]+'.json';win.document.body.appendChild(a);a.click();win.document.body.removeChild(a);win.URL.revokeObjectURL(url)};win.importHistory=function(event){var file=event.target.files[0];if(!file)return;var reader=new win.FileReader();reader.onload=function(e){try{var importedData=JSON.parse(e.target.result);if(!Array.isArray(importedData)){win.alert('Invalid file format');return}var combined=win.rawHistory.concat(importedData);var unique=combined.filter(function(item,index,self){return index===self.findIndex(function(t){return t.word===item.word&&t.sl===item.sl&&t.tl===item.tl&&t.timestamp===item.timestamp})});unique.sort(function(a,b){return new Date(a.timestamp)-new Date(b.timestamp)});win.setLocalStorage('wordrefHistory',JSON.stringify(unique));win.rawHistory=unique;win.groupedHistory=win.groupHistory(unique);win.applySavedSort();win.alert('‚úÖ Import successful: '+importedData.length+' entries')}catch(error){win.alert('Import error: '+error.message)}};reader.readAsText(file);event.target.value=''};win.startQuiz=function(){var history=JSON.parse(win.getLocalStorage('wordrefHistory')||'[]');if(history.length<4){win.alert('You need at least 4 words in your history to practice!\n\nSearch more words first, then try the quiz.');return}var groupedHistory=win.groupHistory(history);if(groupedHistory.length<4){win.alert('You need at least 4 unique words to practice!\n\nCurrent unique words: '+groupedHistory.length);return}var htmlContent='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>üéØ Translation Quiz</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);min-height:100vh;padding:20px;display:flex;align-items:center;justify-content:center}.quiz-container{max-width:600px;width:100%;background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}.header{background:linear-gradient(135deg,#ff7043 0%,#ff5722 100%);color:white;padding:30px;text-align:center}.header h1{font-size:28px;margin-bottom:10px}.header p{opacity:0.9;font-size:14px}.stats-bar{padding:15px 30px;background:#f8f9fa;border-bottom:2px solid #e9ecef;display:flex;justify-content:space-between;font-size:14px;font-weight:600}.stats-bar .correct{color:#28a745}.stats-bar .wrong{color:#dc3545}.question-area{padding:40px 30px;text-align:center}.question-word{font-size:32px;font-weight:700;color:#ff7043;margin-bottom:10px}.question-lang{font-size:16px;color:#6c757d;margin-bottom:30px}.options{display:flex;flex-direction:column;gap:12px}.option-btn{padding:15px 20px;border:2px solid #e9ecef;background:white;border-radius:8px;font-size:16px;cursor:pointer;transition:all 0.3s;text-align:left}.option-btn:hover{border-color:#ff7043;background:#f8f9fa;transform:translateX(5px)}.option-btn.correct{background:#d4edda;border-color:#28a745;animation:pulse 0.5s}.option-btn.wrong{background:#f8d7da;border-color:#dc3545;animation:shake 0.5s}.result-message{margin-top:20px;padding:15px;border-radius:8px;font-weight:600;text-align:center}.result-message.correct{background:#d4edda;color:#155724}.result-message.wrong{background:#f8d7da;color:#721c24}.controls{padding:20px 30px;background:#f8f9fa;display:flex;gap:10px;justify-content:center}.btn{padding:12px 30px;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s}.btn-primary{background:#ff7043;color:white}.btn-primary:hover{background:#ff5722;transform:translateY(-2px)}.btn-secondary{background:#6c757d;color:white}.btn-secondary:hover{background:#5a6268}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}.final-score{text-align:center;padding:40px}.final-score h2{font-size:48px;color:#ff7043;margin-bottom:20px}.final-score p{font-size:18px;color:#6c757d;margin-bottom:30px}</style></head><body><div class="quiz-container"><div class="header"><h1>üéØ Translation Quiz</h1><p>Test your knowledge!</p></div><div class="stats-bar"><div>Question: <span id="questionNum">1</span>/<span id="totalQuestions">10</span></div><div>Correct: <span class="correct" id="correctCount">0</span> | Wrong: <span class="wrong" id="wrongCount">0</span></div></div><div class="question-area" id="questionArea"><div class="question-word" id="questionWord"></div><div class="question-lang" id="questionLang"></div><div class="options" id="options"></div><div class="result-message" id="resultMessage"></div></div><div class="controls" id="controls" style="display:none"><button class="btn btn-primary" id="btnNext">Next Question ‚Üí</button></div></div></body></html>';try{var blob=new win.Blob([htmlContent],{type:'text/html;charset=utf-8'});var blobURL=win.URL.createObjectURL(blob);var quizWin=win.open(blobURL,'_blank','width=800,height=700');if(quizWin){win.setTimeout(function(){var words=groupedHistory;if(!quizWin||quizWin.closed)return;try{quizWin.words=words;quizWin.currentQuestion=0;quizWin.correctAnswers=0;quizWin.wrongAnswers=0;quizWin.maxQuestions=Math.min(10,words.length);quizWin.quizWords=[];quizWin.shuffle=function(array){var arr=array.slice();for(var i=arr.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=arr[i];arr[i]=arr[j];arr[j]=temp}return arr};quizWin.getRandomOptions=function(correctWord,allWords){var opts=[];opts.push({word:correctWord.word||'???',isCorrect:true});var others=[];for(var i=0;i<allWords.length;i++){if(allWords[i].word&&allWords[i].word!==correctWord.word){others.push({word:allWords[i].word,isCorrect:false})}}if(others.length>0){others=quizWin.shuffle(others);for(var i=0;i<3&&i<others.length;i++){opts.push(others[i])}}while(opts.length<4){opts.push({word:'Option '+opts.length,isCorrect:false})}return quizWin.shuffle(opts)};quizWin.generateOptionsWithTranslations=function(questionData,allWords){return Promise.resolve(quizWin.getRandomOptions(questionData,allWords))};quizWin.escapeHtml=function(text){var div=quizWin.document.createElement('div');div.textContent=text;return div.innerHTML};quizWin.showQuestion=function(){if(quizWin.currentQuestion>=quizWin.maxQuestions){quizWin.showFinalScore();return}var questionData=quizWin.quizWords[quizWin.currentQuestion];var options=quizWin.getRandomOptions(questionData,quizWin.words);quizWin.document.getElementById('questionNum').textContent=quizWin.currentQuestion+1;quizWin.document.getElementById('totalQuestions').textContent=quizWin.maxQuestions;quizWin.document.getElementById('questionWord').textContent=questionData.word;quizWin.document.getElementById('questionLang').textContent=questionData.sl.toUpperCase()+' ‚Üí '+questionData.tl.toUpperCase();var optionsHTML='';for(var i=0;i<options.length;i++){var opt=options[i];optionsHTML+='<button class="option-btn" data-correct="'+(opt.isCorrect?'true':'false')+'" data-word="'+quizWin.escapeHtml(opt.word)+'">'+quizWin.escapeHtml(opt.word)+'</button>'}var optionsEl=quizWin.document.getElementById('options');try{if(quizWin.trustedTypes&&quizWin.trustedTypes.createPolicy){if(!quizWin.quizPolicy){try{quizWin.quizPolicy=quizWin.trustedTypes.createPolicy('wordref-quiz-hist',{createHTML:function(s){return s}})}catch(e){quizWin.quizPolicy=quizWin.trustedTypes.defaultPolicy}}if(quizWin.quizPolicy){optionsEl.innerHTML=quizWin.quizPolicy.createHTML(optionsHTML)}else{optionsEl.innerHTML=optionsHTML}}else{optionsEl.innerHTML=optionsHTML}}catch(e){optionsEl.textContent='';var temp=quizWin.document.createElement('div');temp.innerHTML=optionsHTML;while(temp.firstChild){optionsEl.appendChild(temp.firstChild)}}quizWin.document.getElementById('resultMessage').innerHTML='';quizWin.document.getElementById('resultMessage').className='result-message';quizWin.document.getElementById('controls').style.display='none';var btns=quizWin.document.querySelectorAll('.option-btn');for(var i=0;i<btns.length;i++){btns[i].addEventListener('click',function(){quizWin.checkAnswer(this)})}var btnNext=quizWin.document.getElementById('btnNext');if(btnNext){btnNext.addEventListener('click',function(){quizWin.currentQuestion++;quizWin.showQuestion()})}};quizWin.checkAnswer=function(btn){var isCorrect=btn.getAttribute('data-correct')==='true';var allBtns=quizWin.document.querySelectorAll('.option-btn');for(var i=0;i<allBtns.length;i++){allBtns[i].disabled=true;if(allBtns[i].getAttribute('data-correct')==='true'){allBtns[i].classList.add('correct')}}if(isCorrect){btn.classList.add('correct');quizWin.correctAnswers++;quizWin.document.getElementById('resultMessage').innerHTML='‚úÖ Correct!';quizWin.document.getElementById('resultMessage').className='result-message correct'}else{btn.classList.add('wrong');quizWin.wrongAnswers++;quizWin.document.getElementById('resultMessage').innerHTML='‚ùå Wrong! The correct answer is highlighted.';quizWin.document.getElementById('resultMessage').className='result-message wrong'}quizWin.document.getElementById('correctCount').textContent=quizWin.correctAnswers;quizWin.document.getElementById('wrongCount').textContent=quizWin.wrongAnswers;quizWin.document.getElementById('controls').style.display='flex'};quizWin.showFinalScore=function(){var percentage=Math.round((quizWin.correctAnswers/quizWin.maxQuestions)*100);var message='';if(percentage>=90){message='üèÜ Perfect! Outstanding!'}else if(percentage>=80){message='üéâ Excellent! Great work!'}else if(percentage>=70){message='üëç Good! Well done!'}else if(percentage>=60){message='üëå Not bad! Keep practicing!'}else{message='üìö Keep studying! You\'ll improve!'}var html='<div class="final-score"><h2>'+percentage+'%</h2><p>'+message+'</p><p>Correct: '+quizWin.correctAnswers+'/'+quizWin.maxQuestions+'</p></div>';var questionArea=quizWin.document.getElementById('questionArea');var controls=quizWin.document.getElementById('controls');var controlsHTML='<button class="btn btn-primary" onclick="location.reload()">Try Again</button><button class="btn btn-secondary" onclick="window.close()">Close</button>';try{if(quizWin.trustedTypes&&quizWin.trustedTypes.createPolicy){if(!quizWin.quizPolicy){try{quizWin.quizPolicy=quizWin.trustedTypes.createPolicy('wordref-quiz-hist',{createHTML:function(s){return s}})}catch(e){quizWin.quizPolicy=quizWin.trustedTypes.defaultPolicy}}if(quizWin.quizPolicy){questionArea.innerHTML=quizWin.quizPolicy.createHTML(html);controls.innerHTML=quizWin.quizPolicy.createHTML(controlsHTML)}else{questionArea.innerHTML=html;controls.innerHTML=controlsHTML}}else{questionArea.innerHTML=html;controls.innerHTML=controlsHTML}}catch(e){questionArea.textContent='';var temp1=quizWin.document.createElement('div');temp1.innerHTML=html;while(temp1.firstChild){questionArea.appendChild(temp1.firstChild)}controls.textContent='';var temp2=quizWin.document.createElement('div');temp2.innerHTML=controlsHTML;while(temp2.firstChild){controls.appendChild(temp2.firstChild)}}controls.style.display='flex';try{var stats=JSON.parse(localStorage.getItem('wordrefQuizStats'))||{total:0,correct:0};stats.total+=quizWin.maxQuestions;stats.correct+=quizWin.correctAnswers;localStorage.setItem('wordrefQuizStats',JSON.stringify(stats))}catch(e){}};quizWin.quizWords=quizWin.shuffle(quizWin.words).slice(0,quizWin.maxQuestions);quizWin.showQuestion()}catch(e){if(quizWin.console){quizWin.console.error('Error in quiz:',e)}}},300)}else{win.alert('Please allow popups to use the quiz feature!')}}catch(error){win.alert('Could not open quiz: '+error.message)}};var btnQuiz=win.document.getElementById('btnQuiz');var btnSortDate=win.document.getElementById('btnSortDate');var btnSortAlpha=win.document.getElementById('btnSortAlpha');var btnSortCount=win.document.getElementById('btnSortCount');var btnExport=win.document.getElementById('btnExport');var btnImport=win.document.getElementById('btnImport');var importFile=win.document.getElementById('importFile');var btnClear=win.document.getElementById('btnClear');var searchInput=win.document.getElementById('searchInput');var btnClearSearch=win.document.getElementById('btnClearSearch');if(btnQuiz){btnQuiz.addEventListener('click',function(){win.startQuiz()})}if(btnSortDate){btnSortDate.addEventListener('click',function(){win.sortByDate()})}if(btnSortAlpha){btnSortAlpha.addEventListener('click',function(){win.sortAlphabetically()})}if(btnSortCount){btnSortCount.addEventListener('click',function(){win.sortByCount()})}if(btnExport){btnExport.addEventListener('click',function(){win.exportHistory()})}if(btnImport){btnImport.addEventListener('click',function(){if(importFile){importFile.click()}})}if(importFile){importFile.addEventListener('change',win.importHistory)}if(btnClear){btnClear.addEventListener('click',function(){win.clearHistory()})}if(searchInput){searchInput.addEventListener('click',function(){win.searchTerm=this.value;win.applySearch()})}if(btnClearSearch){btnClearSearch.addEventListener('click',function(){win.searchTerm='';if(searchInput){searchInput.value=''}win.applySearch()})}win.applySavedSort()}catch(e){if(win.console){win.console.error('Error injecting scripts:',e)}}}function showInitialDialog(){if(shouldShowDialog()){markDialogShown();const choice=confirm('üåê WordReference Advanced\\n\\n‚úÖ OK = Continue normal flow\\n‚ùå Cancel = View history');if(choice){performTranslation()}else{showHistory()}}else{performTranslation()}}showInitialDialog()})();
