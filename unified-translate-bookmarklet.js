javascript:(function(){'use strict';const STORAGE_KEYS={WORD:'unifiedMemoryWord',PARAMS:'unifiedMemoryParams',HISTORY:'unifiedHistory',LAST_DIALOG:'unifiedLastDialog',SORT_MODE:'unifiedSortMode',QUIZ_STATS:'unifiedQuizStats',LAST_SERVICE:'unifiedLastService'};const SERVICES={GT:{name:'Google Translate',languages:['de','en','es'],defaultSL:'de',defaultTL:'en',domain:'translate.google.com',buildURL:(sl,tl,text)=>'https://translate.google.com/?sl='+sl+'&tl='+tl+'&text='+encodeURIComponent(text)+'&op=translate',colors:{primary:'#667eea',secondary:'#764ba2'}},WR:{name:'WordReference',languages:['en','es','de','fr'],defaultSL:'en',defaultTL:'es',domain:'wordreference.com',buildURL:(sl,tl,text)=>'https://www.wordreference.com/'+sl+tl+'/'+encodeURIComponent(text),colors:{primary:'#ff7043',secondary:'#ff5722'}}};function detectService(){if(window.location.hostname.includes(SERVICES.GT.domain))return'GT';if(window.location.hostname.includes(SERVICES.WR.domain))return'WR';return null}function getLastService(){return localStorage.getItem(STORAGE_KEYS.LAST_SERVICE)||'GT'}function setLastService(service){localStorage.setItem(STORAGE_KEYS.LAST_SERVICE,service)}function chooseService(){const lastService=getLastService();const serviceName=lastService==='GT'?'Google Translate':'WordReference';const choice=confirm('üåê Choose Translation Service\\n\\nOK = '+serviceName+' (last used)\\nCancel = Switch service');if(choice){return lastService}return lastService==='GT'?'WR':'GT'}function getCurrentService(){let service=detectService();if(!service){service=chooseService()}setLastService(service);return service}function getNextLanguage(currentLang,sourceLang,languages){const currentIndex=languages.indexOf(currentLang);let nextIndex=(currentIndex+1)%languages.length;let nextLang=languages[nextIndex];if(nextLang===sourceLang){nextIndex=(nextIndex+1)%languages.length;nextLang=languages[nextIndex]}return nextLang}function getSavedParams(service){const saved=localStorage.getItem(STORAGE_KEYS.PARAMS);if(!saved){return{service:service,sl:SERVICES[service].defaultSL,tl:SERVICES[service].defaultTL,text:''}}const params=JSON.parse(saved);if(params.service!==service){return{service:service,sl:SERVICES[service].defaultSL,tl:SERVICES[service].defaultTL,text:''}}return params}function saveParams(service,sl,tl,text){const params={service,sl,tl,text};localStorage.setItem(STORAGE_KEYS.PARAMS,JSON.stringify(params));localStorage.setItem(STORAGE_KEYS.WORD,text)}function getHistory(){const history=localStorage.getItem(STORAGE_KEYS.HISTORY);return history?JSON.parse(history):[]}function addToHistory(word,sl,tl,service){if(!word||word.trim()==='')return;const history=getHistory();const entry={word:word.trim(),sl:sl,tl:tl,service:service,timestamp:new Date().toISOString()};if(history.length>0){const lastEntry=history[history.length-1];if(lastEntry.word===entry.word&&lastEntry.sl===entry.sl&&lastEntry.tl===entry.tl){return}}history.push(entry);localStorage.setItem(STORAGE_KEYS.HISTORY,JSON.stringify(history))}function navigateToURL(url,service){if(detectService()===service){window.location.href=url}else{window.open(url,'_blank')}}function shouldShowDialog(){const history=getHistory();if(history.length===0){return true}const lastDialog=localStorage.getItem(STORAGE_KEYS.LAST_DIALOG);if(!lastDialog){return true}const lastDate=new Date(lastDialog);const today=new Date();if(lastDate.getFullYear()!==today.getFullYear()||lastDate.getMonth()!==today.getMonth()||lastDate.getDate()!==today.getDate()){return true}return false}function markDialogShown(){localStorage.setItem(STORAGE_KEYS.LAST_DIALOG,new Date().toISOString())}function performTranslation(service){const savedParams=getSavedParams(service);const lastWord=localStorage.getItem(STORAGE_KEYS.WORD)||'';const serviceName=SERVICES[service].name;const userInput=prompt('Word to translate ('+serviceName+'):\\n(Empty, "history", "?", "quiz" or "switch")',lastWord);if(userInput===null)return;const trimmedInput=userInput.trim().toLowerCase();if(trimmedInput==='switch'){const newService=service==='GT'?'WR':'GT';setLastService(newService);performTranslation(newService);return}if(trimmedInput==='quiz'||trimmedInput==='practice'){startQuiz();return}if(trimmedInput===''||trimmedInput==='history'||trimmedInput==='?'){showHistory();return}const originalInput=userInput.trim();const wordChanged=originalInput!==lastWord;let sl=savedParams.sl;let tl=savedParams.tl;if(!wordChanged){tl=getNextLanguage(tl,sl,SERVICES[service].languages)}saveParams(service,sl,tl,originalInput);addToHistory(originalInput,sl,tl,service);const url=SERVICES[service].buildURL(sl,tl,originalInput);navigateToURL(url,service)}function startQuiz(){const history=getHistory();if(history.length<4){alert('You need at least 4 words in your history to practice!\\n\\nSearch more words first, then try the quiz.');return}const groupedHistory=groupHistory(history);if(groupedHistory.length<4){alert('You need at least 4 unique words to practice!\\n\\nCurrent unique words: '+groupedHistory.length);return}showQuizWindow(groupedHistory)}function showQuizWindow(words){const htmlContent=generateQuizHTML();try{const blob=new Blob([htmlContent],{type:'text/html;charset=utf-8'});const blobURL=URL.createObjectURL(blob);const quizWin=window.open(blobURL,'_blank','width=800,height=700');if(quizWin){setTimeout(function(){injectQuizScripts(quizWin,words)},300)}else{alert('Please allow popups to use the quiz feature!')}}catch(error){alert('Could not open quiz: '+error.message)}}function generateQuizHTML(){return'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>üéØ Translation Quiz</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#ff7043 100%);min-height:100vh;padding:20px;display:flex;align-items:center;justify-content:center}.quiz-container{max-width:600px;width:100%;background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}.header{background:linear-gradient(135deg,#667eea 0%,#ff7043 100%);color:white;padding:30px;text-align:center}.header h1{font-size:28px;margin-bottom:10px}.header p{opacity:0.9;font-size:14px}.stats-bar{padding:15px 30px;background:#f8f9fa;border-bottom:2px solid #e9ecef;display:flex;justify-content:space-between;font-size:14px;font-weight:600}.stats-bar .correct{color:#28a745}.stats-bar .wrong{color:#dc3545}.question-area{padding:40px 30px;text-align:center}.question-word{font-size:32px;font-weight:700;color:#667eea;margin-bottom:10px}.question-lang{font-size:16px;color:#6c757d;margin-bottom:30px}.options{display:flex;flex-direction:column;gap:12px}.option-btn{padding:15px 20px;border:2px solid #e9ecef;background:white;border-radius:8px;font-size:16px;cursor:pointer;transition:all 0.3s;text-align:left}.option-btn:hover{border-color:#667eea;background:#f8f9fa;transform:translateX(5px)}.option-btn.correct{background:#d4edda;border-color:#28a745;animation:pulse 0.5s}.option-btn.wrong{background:#f8d7da;border-color:#dc3545;animation:shake 0.5s}.result-message{margin-top:20px;padding:15px;border-radius:8px;font-weight:600;text-align:center}.result-message.correct{background:#d4edda;color:#155724}.result-message.wrong{background:#f8d7da;color:#721c24}.controls{padding:20px 30px;background:#f8f9fa;display:flex;gap:10px;justify-content:center}.btn{padding:12px 30px;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s}.btn-primary{background:#667eea;color:white}.btn-primary:hover{background:#5568d3;transform:translateY(-2px)}.btn-secondary{background:#6c757d;color:white}.btn-secondary:hover{background:#5a6268}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}.final-score{text-align:center;padding:40px}.final-score h2{font-size:48px;color:#667eea;margin-bottom:20px}.final-score p{font-size:18px;color:#6c757d;margin-bottom:30px}</style></head><body><div class="quiz-container"><div class="header"><h1>üéØ Translation Quiz</h1><p>Unified Practice Mode</p></div><div class="stats-bar"><div>Question: <span id="questionNum">1</span>/<span id="totalQuestions">10</span></div><div>Correct: <span class="correct" id="correctCount">0</span> | Wrong: <span class="wrong" id="wrongCount">0</span></div></div><div class="question-area" id="questionArea"><div class="question-word" id="questionWord"></div><div class="question-lang" id="questionLang"></div><div class="options" id="options"></div><div class="result-message" id="resultMessage"></div></div><div class="controls" id="controls" style="display:none"><button class="btn btn-primary" id="btnNext">Next Question ‚Üí</button></div></div></body></html>'}function injectQuizScripts(win,words){if(!win||win.closed)return;try{win.words=words;win.currentQuestion=0;win.correctAnswers=0;win.wrongAnswers=0;win.maxQuestions=Math.min(10,words.length);win.quizWords=[];win.shuffle=function(array){var arr=array.slice();for(var i=arr.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=arr[i];arr[i]=arr[j];arr[j]=temp}return arr};win.getRandomOptions=function(correctWord,allWords){var options=[correctWord];var otherWords=allWords.filter(function(w){return w.word!==correctWord.word&&w.sl===correctWord.sl&&w.tl===correctWord.tl});while(options.length<4&&otherWords.length>0){var randomIndex=Math.floor(Math.random()*otherWords.length);options.push(otherWords.splice(randomIndex,1)[0])}while(options.length<4){options.push({word:'---',sl:correctWord.sl,tl:correctWord.tl})}return win.shuffle(options)};win.escapeHtml=function(text){var div=win.document.createElement('div');div.textContent=text;return div.innerHTML};win.showQuestion=function(){if(win.currentQuestion>=win.maxQuestions){win.showFinalScore();return}var questionData=win.quizWords[win.currentQuestion];var options=win.getRandomOptions(questionData,win.words);win.document.getElementById('questionNum').textContent=win.currentQuestion+1;win.document.getElementById('totalQuestions').textContent=win.maxQuestions;win.document.getElementById('questionWord').textContent=questionData.word;win.document.getElementById('questionLang').textContent=questionData.sl.toUpperCase()+' ‚Üí '+questionData.tl.toUpperCase();var optionsHTML='';for(var i=0;i<options.length;i++){var opt=options[i];var isCorrect=opt.word===questionData.word;optionsHTML+='<button class="option-btn" data-correct="'+isCorrect+'" data-word="'+win.escapeHtml(opt.word)+'">'+win.escapeHtml(opt.word)+'</button>'}win.document.getElementById('options').innerHTML=optionsHTML;win.document.getElementById('resultMessage').innerHTML='';win.document.getElementById('resultMessage').className='result-message';win.document.getElementById('controls').style.display='none';var btns=win.document.querySelectorAll('.option-btn');for(var i=0;i<btns.length;i++){btns[i].addEventListener('click',function(){win.checkAnswer(this)})}};win.checkAnswer=function(btn){var isCorrect=btn.getAttribute('data-correct')==='true';var allBtns=win.document.querySelectorAll('.option-btn');for(var i=0;i<allBtns.length;i++){allBtns[i].disabled=true;if(allBtns[i].getAttribute('data-correct')==='true'){allBtns[i].classList.add('correct')}}if(isCorrect){btn.classList.add('correct');win.correctAnswers++;win.document.getElementById('resultMessage').innerHTML='‚úÖ Correct!';win.document.getElementById('resultMessage').className='result-message correct'}else{btn.classList.add('wrong');win.wrongAnswers++;win.document.getElementById('resultMessage').innerHTML='‚ùå Wrong! The correct answer is highlighted.';win.document.getElementById('resultMessage').className='result-message wrong'}win.document.getElementById('correctCount').textContent=win.correctAnswers;win.document.getElementById('wrongCount').textContent=win.wrongAnswers;win.document.getElementById('controls').style.display='flex'};win.showFinalScore=function(){var percentage=Math.round((win.correctAnswers/win.maxQuestions)*100);var message='';if(percentage>=90){message='üèÜ Perfect! Outstanding!'}else if(percentage>=80){message='üéâ Excellent! Great work!'}else if(percentage>=70){message='üëç Good! Well done!'}else if(percentage>=60){message='üëå Not bad! Keep practicing!'}else{message='üìö Keep studying! You\'ll improve!'}var html='<div class="final-score"><h2>'+percentage+'%</h2><p>'+message+'</p><p>Correct: '+win.correctAnswers+'/'+win.maxQuestions+'</p></div>';win.document.getElementById('questionArea').innerHTML=html;win.document.getElementById('controls').innerHTML='<button class="btn btn-primary" onclick="location.reload()">Try Again</button><button class="btn btn-secondary" onclick="window.close()">Close</button>';win.document.getElementById('controls').style.display='flex';try{var stats=JSON.parse(localStorage.getItem('unifiedQuizStats'))||{total:0,correct:0};stats.total+=win.maxQuestions;stats.correct+=win.correctAnswers;localStorage.setItem('unifiedQuizStats',JSON.stringify(stats))}catch(e){}};win.quizWords=win.shuffle(win.words).slice(0,win.maxQuestions);win.showQuestion()}catch(e){if(win.console){win.console.error('Error in quiz:',e)}}}function groupHistory(history){const grouped={};history.forEach(item=>{const key=item.word;if(!grouped[key]){grouped[key]={word:item.word,sl:item.sl,tl:item.tl,service:item.service||'GT',count:0,firstDate:item.timestamp,lastDate:item.timestamp}}grouped[key].count++;if(new Date(item.timestamp)>new Date(grouped[key].lastDate)){grouped[key].lastDate=item.timestamp;grouped[key].sl=item.sl;grouped[key].tl=item.tl;grouped[key].service=item.service||'GT'}});return Object.values(grouped)}function showHistory(){alert('Unified history feature coming soon! Use individual bookmarklets to view full history.')}function showInitialDialog(){const service=getCurrentService();if(shouldShowDialog()){markDialogShown();const serviceName=SERVICES[service].name;const choice=confirm('üåê Unified Translation Bookmarklet\\n\\nCurrent: '+serviceName+'\\n\\n‚úÖ OK = Continue\\n‚ùå Cancel = View history');if(choice){performTranslation(service)}else{showHistory()}}else{performTranslation(service)}}showInitialDialog()})();
